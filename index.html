<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="./vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>constellation</title>
  <script type="module">var{atan2:e,cos:t,pow:n,sign:r,sin:i,sqrt:a,PI:o}=Math,s=`http://www.w3.org/2000/svg`;function c(){let e=window.innerWidth,t=window.innerHeight;document.querySelector(`svg`).setAttribute(`viewBox`,`${-e/2} ${-t/2} ${e} ${t}`)}window.addEventListener(`resize`,c),c();var l=document.querySelector(`g`);l.setAttribute(`transform`,`scale(1, -1)`);function u(e,t){let n=document.createElementNS(s,e);return Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),l.appendChild(n)}function d(e){return e*o/180}function f({cx:e,cy:t,radius:r},{cx:i,cy:o,radius:s}){let c=i-e,l=o-t,u=n(c,2)+n(l,2),d=a(u),f=n(r,2),p=(f-n(s,2)+u)/(2*d),m=a(f-n(p,2)),h=e+p*c/d,g=t+p*l/d;return[h-m*l/d,g+m*c/d]}var p={.85:{.85:[[0,.85,-1],[1,.85,1]],1:[[0,.85,-1],[0,.85,1]],1.15:[[1,1.15,1],[0,.85,1]]},1:{.85:[[1,.85,-1],[1,.85,1]],1.15:[[1,1.15,1],[1,1.15,-1]]},1.15:{.85:[[1,.85,-1],[0,1.15,-1]],1:[[0,1.15,1],[0,1.15,-1]],1.15:[[0,1.15,1],[1,1.15,-1]]}},m=[],h=[{.85:[],1:[],1.15:[]},{.85:[],1:[],1.15:[]},{.85:[],1:[],1.15:[]}];function g(e,t,n=3){let i=e.map(e=>m.find(t=>t.locations.find(({center:t,scale:n,order:r})=>t===e.center&&n===e.scale&&r===e.order))),a=h[e[0].center][e[0].scale].map(e=>m.find(t=>t.locations.find(({center:t,scale:n,order:r})=>t===e.center&&n===e.scale&&r===e.order))).map(({locations:e})=>e),o=e.length;for(let s=0;s<o;s++){let o=i[s].locations.find(({center:t})=>t===e[0].center);i[s].stage=a[(o.order+12+t)%12];let c=i[s].stage.find(({center:t})=>t===e[0].center),l=c.angle-o.angle,u=[];for(let e=0;e<(r(t)*l+360)%360;e+=n)u.push((o.angle+r(t)*e+360)%360);u[u.length-1]=c.angle,i[s].queue.push({cx:o.cx,cy:o.cy,radius:o.radius,angles:u})}return i}var _=class{center;color;element;locations=[];queue=[];radius;stage;x;y;constructor(e,t,n){this.center=3-e.center-t.center,this.color=n;let[r,i]=f(e,t);this.x=r,this.y=i,this.locations.push(C(e,r,i),C(t,r,i)),h[e.center][e.scale].push(this.locations[0]),h[t.center][t.scale].push(this.locations[1]),h.push(...this.locations);let a=this.element=u(`circle`,{cx:r,cy:i,r:10,fill:n,class:`node`});a.addEventListener(`click`,this.clickHandler.bind(this,1)),a.addEventListener(`contextmenu`,this.clickHandler.bind(this,-1)),m.push(this)}render(){let e=this.locations[0];this.center=3-e.center-this.locations[1].center;let n=e.cx+e.radius*i(d(e.angle)),r=e.cy+e.radius*t(d(e.angle));if(this.queue.length){let e=this.queue[0],a=e.angles.shift();a===void 0?this.queue.shift():(n=e.cx+e.radius*i(d(a)),r=e.cy+e.radius*t(d(a)))}this.element.setAttribute(`cx`,n),this.element.setAttribute(`cy`,r)}clickHandler(e,t){t.preventDefault(),t.stopPropagation(),console.log(`c: ${this.center} s0: ${this.locations[0].scale} s1: ${this.locations[1].scale}`);let n=e,r=.85;(this.locations[0].center-this.locations[1].center+3)%3==2&&(n*=-1,r=1.15);let i=h[this.center][r];g(i,n*3).forEach(e=>e.locations=e.stage);let a=m.filter(({locations:e})=>e[0].center===this.locations[0].center&&e[1].center===this.locations[1].center);console.log(a),e=e===1?0:1;for(let t=0;t<2;t++){let t=[];for(let n of a){if(n.locations[0].scale===1&&n.locations[1].scale===1)continue;let r=p[n.locations[0].scale][n.locations[1].scale][e],i=[n.locations[r[0]]];t.push(...g(i,r[2],.7))}t.forEach(e=>e.locations=e.stage),console.log(t)}}},v=100,y=a(3)*v,b=[.85,1,1.15],x=[{cx:v*i(d(0)),cy:v*t(d(0))},{cx:v*i(d(120)),cy:v*t(d(120))},{cx:v*i(d(240)),cy:v*t(d(240))}];function S(e,t){return{...x[e],center:e,scale:t,radius:y*t}}function C(t,n,r){return{...t,angle:(e(n-t.cx,r-t.cy)*180/o+360)%360}}for(let{cx:e,cy:t}of x)for(let n of b)u(`circle`,{cx:e,cy:t,r:y*n,class:`orbit`});for(let[e,t,n]of[[0,2,`blue`],[2,0,`green`],[2,1,`white`],[1,2,`yellow`],[1,0,`red`],[0,1,`orange`]])for(let r of b)for(let i of b)new _(S(e,r),S(t,i),n);for(let e=0;e<x.length;e++)for(let t of b)h[e][t].sort((e,t)=>e.angle-t.angle),h[e][t].forEach((e,t)=>e.order=t);setInterval(()=>{m.forEach(e=>e.render())},25);</script>
  <style rel="stylesheet" crossorigin>svg{background-color:#faebd7;width:100vw;height:100vh;position:fixed;top:0;left:0}.orbit,.node{stroke:#000;stroke-width:1px}.orbit{fill:none}
/*$vite$:1*/</style>
</head>

<body>
  <svg>
    <g />
  </svg>
</body>

</html>