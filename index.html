<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>constellation</title>
    <script type="module">var{PI:e,sin:t,cos:n,sqrt:r,pow:i}=Math,a=`http://www.w3.org/2000/svg`,o=document.querySelector(`#scene`),s=240,c=class{constructor(e,t,n,r,i){this.centerId=e,this.center=t,this.radius=n,this.angle=r,this.scale=i}},l=class{constructor(e,t,n,r){this.position=e,this.locationA=t,this.locationB=n,this.element=r,this.anim=null}startAnimation(e,t,n,a){this.anim={center:e,fromAngle:t,deltaAngle:n,radius:r(i(this.position.x-e.x,2)+i(this.position.y-e.y,2)),start:performance.now(),duration:a}}tick(r){if(!this.anim)return!1;let{center:i,fromAngle:a,deltaAngle:o,radius:s,start:c,duration:l}=this.anim,u=Math.min(1,(r-c)/l),d=(a+o*u+360)%360*e/180,f=i.x+n(d)*s,p=i.y+t(d)*s;return this.position={x:f,y:p},this.element.setAttribute(`cx`,f),this.element.setAttribute(`cy`,p),_&&console.log(`tick`,{position:this.position,locationA:this.locationA,locationB:this.locationB}),u>=1?(this.anim=null,!1):!0}};function u(t){return t/180*e}function d(e,t,n,a,o,s){let c=i(a-e,2)+i(o-t,2),l=r(c),u=(i(n,2)-i(s,2)+c)/(2*l),d=r(i(n,2)-i(u,2)),f=e+u*(a-e)/l,p=t+u*(o-t)/l;return[f-d*(o-t)/l,p+d*(a-e)/l,f+d*(o-t)/l,p-d*(a-e)/l]}function f(e,t={}){let n=document.createElementNS(a,e);for(let[e,r]of Object.entries(t))n.setAttribute(e,String(r));return n}function p(t,n){return(Math.atan2(n.y-t.y,n.x-t.x)*180/e+360)%360}var m=null,h=!1,g=null,_=!1,v=[];function y(){let e=window.innerWidth,i=window.innerHeight;o.setAttribute(`viewBox`,`${-e/2} ${-i/2} ${e} ${i}`),o.replaceChildren();let a=f(`g`,{transform:`scale(1,-1)`}),s=100*t(u(120)),h=100*n(u(120)),g=100*t(u(240)),_=100*n(u(240)),v=100*r(3),y=[.85,1,1.15];for(let e of y){let t=v*e;a.append(f(`circle`,{cx:0,cy:100,r:t,class:`orbit`})),a.append(f(`circle`,{cx:s,cy:h,r:t,class:`orbit`})),a.append(f(`circle`,{cx:g,cy:_,r:t,class:`orbit`}))}let b=[],x=[];m={c0:{x:0,y:100},c1:{x:s,y:h},c2:{x:g,y:_}};let w=[{a:{id:`c2`,x:g,y:_},b:{id:`c1`,x:s,y:h},colors:[`white`,`yellow`]},{a:{id:`c1`,x:s,y:h},b:{id:`c0`,x:0,y:100},colors:[`orange`,`red`]},{a:{id:`c0`,x:0,y:100},b:{id:`c2`,x:g,y:_},colors:[`green`,`blue`]}];for(let e of w)for(let t=0;t<y.length;t++)for(let n=0;n<y.length;n++){let r=y[t],i=y[n],o=v*r,s=v*i,[u,m,h,g]=d(e.a.x,e.a.y,o,e.b.x,e.b.y,s),_=[{x:u,y:m},{x:h,y:g}].sort((e,t)=>p({x:0,y:0},e)-p({x:0,y:0},t));for(let t=0;t<_.length;t++){let n=_[t],u=f(`circle`,{cx:n.x,cy:n.y,r:10,class:`node`,fill:e.colors[t],stroke:`grey`}),d=new c(e.a.id,{x:e.a.x,y:e.a.y},o,p({x:e.a.x,y:e.a.y},n),r),m=new c(e.b.id,{x:e.b.x,y:e.b.y},s,p({x:e.b.x,y:e.b.y},n),i),h=[e.a.id,e.b.id].sort(),g=e.a.id===h[0]?new l(n,d,m,u):new l(n,m,d,u);x.push(g),u.__hit=g,u.addEventListener(`click`,S),u.addEventListener(`contextmenu`,C),b.push(u),a.append(u)}}return o.append(a),x}var b=y();window.addEventListener(`resize`,()=>{b=y()});function x(e){if(!h){if(e.locationA.scale===1&&e.locationB.scale===1){let t=e.element.getAttribute(`fill`),n=[`yellow`,`green`,`orange`].includes(t),r=T(e.locationA.centerId,e.locationB.centerId),i=m?.[r];if(!i)return;n?w(i,1.15,3):w(i,.85,-3)}console.log(`Intersection:`,{position:e.position,locationA:e.locationA,locationB:e.locationB})}}function S(e){e.stopPropagation();let t=e.currentTarget.__hit;t&&x(t)}function C(e){console.log(`hick`),e.preventDefault(),e.stopPropagation(),_=!_,console.log(`Logging: ${_?`on`:`off`}`)}function w(e,t,n){let r=b.map(n=>n.locationA.scale===t&&n.locationA.center.x===e.x&&n.locationA.center.y===e.y?{hit:n,angle:n.locationA.angle}:n.locationB.scale===t&&n.locationB.center.x===e.x&&n.locationB.center.y===e.y?{hit:n,angle:n.locationB.angle}:null).filter(Boolean).sort((e,t)=>e.angle-t.angle);r.length!==0&&E(r.map(e=>e.hit),e,n)}function T(e,t){for(let n of[`c0`,`c1`,`c2`])if(n!==e&&n!==t)return n;return`c0`}function E(e,t,n){let a=e.length;if(a===0)return;h=!0;let o=e.map(e=>({x:e.position.x,y:e.position.y})),c=e.map(e=>r(i(e.position.x-t.x,2)+i(e.position.y-t.y,2))),l=Math.max(1,Math.min(...c));for(let r=0;r<e.length;r++){let i=e[r],o=e[(r+n+a)%a],u=p(t,i.position),d=p(t,o.position),f=n>0?(d-u+360)%360:-((u-d+360)%360),m=c[r],h=Math.abs(f)/s*1e3*(m/l);i.startAnimation(t,u,f,h)}v.push(()=>{let t=Array(a);for(let r=0;r<a;r++){let i=(r+n+a)%a;t[i]=e[r]}for(let e=0;e<a;e++){let n=t[e],r=o[e];n.position={x:r.x,y:r.y},n.element.setAttribute(`cx`,r.x),n.element.setAttribute(`cy`,r.y),n.element.__hit=n}}),g||=requestAnimationFrame(D)}function D(e){let t=!1;for(let n of b)n.tick(e)&&(t=!0);if(t){g=requestAnimationFrame(D);return}h=!1;for(let e of v)e();v=[],g=null}</script>
    <style rel="stylesheet" crossorigin>*{box-sizing:border-box}html,body{background:#f7f2e8;width:100%;height:100%;margin:0}svg{width:100vw;height:100vh;position:fixed;inset:0}.orbit{fill:none;stroke:#1a1a1a;stroke-width:1.5px;opacity:.75}.node{stroke-width:1px}
/*$vite$:1*/</style>
  </head>
  <body>
    <svg id="scene" aria-hidden="true"></svg>
  </body>
</html>
