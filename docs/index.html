<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="./vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>constellation</title>
  <script type="module">var{abs:e,atan2:t,cos:n,pow:r,sign:i,sin:a,sqrt:o,PI:s}=Math,c=`http://www.w3.org/2000/svg`,l=new URLSearchParams(window.location.search),u=e(l.get(`faceRotation`)??1),d=i(l.get(`faceRotation`)??1);function f(){let e=window.innerWidth,t=window.innerHeight;document.querySelector(`svg`).setAttribute(`viewBox`,`${-e/2} ${-t/2} ${e} ${t}`)}window.addEventListener(`resize`,f),f();var p=document.querySelector(`g`);p.setAttribute(`transform`,`scale(1, -1)`);function m(e,t){let n=document.createElementNS(c,e);return Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),p.appendChild(n)}function h(e){return e*s/180}function g({cx:e,cy:t,radius:n},{cx:i,cy:a,radius:s}){let c=i-e,l=a-t,u=r(c,2)+r(l,2),d=o(u),f=r(n,2),p=(f-r(s,2)+u)/(2*d),m=o(f-r(p,2)),h=e+p*c/d,g=t+p*l/d;return[h-m*l/d,g+m*c/d]}var _={.85:{.85:[[0,-1],[1,1]],1:[[0,-1],[0,1]],1.15:[[1,1],[0,1]]},1:{.85:[[1,-1],[1,1]],1.15:[[1,1],[1,-1]]},1.15:{.85:[[1,-1],[0,-1]],1:[[0,1],[0,-1]],1.15:[[0,1],[1,-1]]}},v=[],y=[{.85:[],1:[],1.15:[]},{.85:[],1:[],1.15:[]},{.85:[],1:[],1.15:[]}];function b(e,t,n=3){let r=e.map(e=>v.find(t=>t.locations.find(({center:t,scale:n,order:r})=>t===e.center&&n===e.scale&&r===e.order))),a=y[e[0].center][e[0].scale].map(e=>v.find(t=>t.locations.find(({center:t,scale:n,order:r})=>t===e.center&&n===e.scale&&r===e.order))).map(({locations:e})=>e),o=e.length;for(let s=0;s<o;s++){let o=r[s].locations.find(({center:t})=>t===e[0].center);r[s].stage=a[(o.order+12+t)%12];let c=r[s].stage.find(({center:t})=>t===e[0].center),l=c.angle-o.angle,u=[];for(let e=0;e<(i(t)*l+360)%360;e+=n)u.push((o.angle+i(t)*e+360)%360);u[u.length-1]=c.angle,r[s].queue.push({cx:o.cx,cy:o.cy,radius:o.radius,angles:u})}return r}var x=class{center;color;element;locations=[];queue=[];radius;stage;x;y;constructor(e,t,n){this.center=3-e.center-t.center,this.color=n;let[r,i]=g(e,t);this.x=r,this.y=i,this.locations.push(D(e,r,i),D(t,r,i)),y[e.center][e.scale].push(this.locations[0]),y[t.center][t.scale].push(this.locations[1]);let a=this.element=m(`circle`,{cx:r,cy:i,r:6,fill:n,class:`node`});a.addEventListener(`click`,this.clickHandler.bind(this,1)),a.addEventListener(`contextmenu`,this.clickHandler.bind(this,-1)),v.push(this)}render(){let e=this.locations[0];this.center=3-e.center-this.locations[1].center;let t=e.cx+e.radius*a(h(e.angle)),r=e.cy+e.radius*n(h(e.angle));if(this.queue.length){let e=this.queue[0],i=e.angles.shift();i===void 0?this.queue.shift():(t=e.cx+e.radius*a(h(i)),r=e.cy+e.radius*n(h(i)))}this.element.setAttribute(`cx`,t),this.element.setAttribute(`cy`,r)}clickHandler(e,t){t.preventDefault(),t.stopPropagation(),console.log(`c: ${this.center} s0: ${this.locations[0].scale} s1: ${this.locations[1].scale}`);let n=e,r=.85;(this.locations[0].center-this.locations[1].center+3)%3==2&&(n*=-1,r=1.15);let i=y[this.center][r];b(i,n*3).forEach(e=>e.locations=e.stage);let a=v.filter(({locations:e})=>e[0].center===this.locations[0].center&&e[1].center===this.locations[1].center);e=e*d===1?0:1;for(let t=0;t<2*u;t++){let t=[];for(let n of a){if(n.locations[0].scale===1&&n.locations[1].scale===1)continue;let r=_[n.locations[0].scale][n.locations[1].scale][e],i=[n.locations[r[0]]];t.push(...b(i,r[1],.7*u))}t.forEach(e=>e.locations=e.stage)}}},S=60,C=o(3)*S,w=[.85,1,1.15],T=[{cx:S*a(h(0)),cy:S*n(h(0))},{cx:S*a(h(120)),cy:S*n(h(120))},{cx:S*a(h(240)),cy:S*n(h(240))}];function E(e,t){return{...T[e],center:e,scale:t,radius:C*t}}function D(e,n,r){return{...e,angle:(t(n-e.cx,r-e.cy)*180/s+360)%360}}for(let{cx:e,cy:t}of T)for(let n of w)m(`circle`,{cx:e,cy:t,r:C*n,class:`orbit`});for(let[e,t,n]of[[0,2,`blue`],[2,0,`green`],[2,1,`white`],[1,2,`yellow`],[1,0,`red`],[0,1,`orange`]])for(let r of w)for(let i of w)new x(E(e,r),E(t,i),n);for(let e=0;e<T.length;e++)for(let t of w)y[e][t].sort((e,t)=>e.angle-t.angle),y[e][t].forEach((e,t)=>e.order=t);setInterval(()=>{v.forEach(e=>e.render())},25);</script>
  <style rel="stylesheet" crossorigin>svg{background-color:#faebd7;width:100vw;height:100vh;position:fixed;top:0;left:0}.orbit,.node{stroke:#000;stroke-width:1px}.orbit{fill:none}
/*$vite$:1*/</style>
</head>

<body>
  <svg>
    <g />
  </svg>
</body>

</html>