<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="./vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>constellation</title>
  <script type="module">var{abs:e,atan2:t,cos:n,pow:r,sign:i,sin:a,sqrt:o,PI:s}=Math,c=`http://www.w3.org/2000/svg`,l=new URL(window.location.href);l.searchParams.set(`faceRotation`,l.searchParams.get(`faceRotation`)??`1`);var u=e(l.searchParams.get(`faceRotation`)??`1`),d=i(l.searchParams.get(`faceRotation`)??`1`),f=atob(l.searchParams.get(`nodes`)??``).split(`,`);window.history.replaceState({},``,l.href);function p(){let e=window.innerWidth,t=window.innerHeight;document.querySelector(`svg`).setAttribute(`viewBox`,`${-e/2} ${-t/2} ${e} ${t}`)}window.addEventListener(`resize`,p),p();var m=document.querySelector(`g`);m.setAttribute(`transform`,`scale(1, -1)`);function h(e,t){let n=document.createElementNS(c,e);return Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),m.appendChild(n)}function g(e){return e*s/180}function _({cx:e,cy:t,radius:n},{cx:i,cy:a,radius:s}){let c=i-e,l=a-t,u=r(c,2)+r(l,2),d=o(u),f=r(n,2),p=(f-r(s,2)+u)/(2*d),m=o(f-r(p,2)),h=e+p*c/d,g=t+p*l/d;return[h-m*l/d,g+m*c/d]}var v={.85:{.85:[[0,-1],[1,1]],1:[[0,-1],[0,1]],1.15:[[1,1],[0,1]]},1:{.85:[[1,-1],[1,1]],1.15:[[1,1],[1,-1]]},1.15:{.85:[[1,-1],[0,-1]],1:[[0,1],[0,-1]],1.15:[[0,1],[1,-1]]}},y=[],b=[{.85:[],1:[],1.15:[]},{.85:[],1:[],1.15:[]},{.85:[],1:[],1.15:[]}];function x(e,t,n=3){let r=e.map(e=>y.find(t=>t.locations.find(({center:t,scale:n,order:r})=>t===e.center&&n===e.scale&&r===e.order))),a=b[e[0].center][e[0].scale].map(e=>y.find(t=>t.locations.find(({center:t,scale:n,order:r})=>t===e.center&&n===e.scale&&r===e.order))).map(({locations:e})=>e),o=e.length;for(let s=0;s<o;s++){let o=r[s].locations.find(({center:t})=>t===e[0].center);r[s].stage=a[(o.order+12+t)%12];let c=r[s].stage.find(({center:t})=>t===e[0].center),l=c.angle-o.angle,u=[];for(let e=0;e<(i(t)*l+360)%360;e+=n)u.push((o.angle+i(t)*e+360)%360);u[u.length-1]=c.angle,r[s].queue.push({cx:o.cx,cy:o.cy,radius:o.radius,angles:u})}return r}function S(e){return 15*e.locations[0].center+5*e.locations[1].center+3*e.locations[0].scale+e.locations[1].scale}function C(){y.sort((e,t)=>S(e)-S(t))}function w(){C();let e=y.map(({color:e})=>e).join(`,`),t=btoa(e);l.searchParams.set(`nodes`,t),window.history.replaceState(null,``,l.href)}var T=class{center;color;element;locations=[];queue=[];radius;stage;x;y;constructor(e,t,n){this.center=3-e.center-t.center,this.color=n;let[r,i]=_(e,t);this.x=r,this.y=i,this.locations.push(j(e,r,i),j(t,r,i)),b[e.center][e.scale].push(this.locations[0]),b[t.center][t.scale].push(this.locations[1]);let a=this.element=h(`circle`,{cx:r,cy:i,r:6,fill:n,class:`node`});a.addEventListener(`click`,this.clickHandler.bind(this,1)),a.addEventListener(`contextmenu`,this.clickHandler.bind(this,-1)),y.push(this)}render(){let e=this.locations[0];this.center=3-e.center-this.locations[1].center;let t=e.cx+e.radius*a(g(e.angle)),r=e.cy+e.radius*n(g(e.angle));if(this.queue.length){let e=this.queue[0],i=e.angles.shift();i===void 0?this.queue.shift():(t=e.cx+e.radius*a(g(i)),r=e.cy+e.radius*n(g(i)))}this.element.setAttribute(`cx`,t),this.element.setAttribute(`cy`,r)}clickHandler(e,t){t.preventDefault(),t.stopPropagation(),console.log(`c: ${this.center} s0: ${this.locations[0].scale} s1: ${this.locations[1].scale}`);let n=e,r=.85;(this.locations[0].center-this.locations[1].center+3)%3==2&&(n*=-1,r=1.15);let i=b[this.center][r];x(i,n*3).forEach(e=>e.locations=e.stage);let a=y.filter(({locations:e})=>e[0].center===this.locations[0].center&&e[1].center===this.locations[1].center);e=e*d===1?0:1;for(let t=0;t<2*u;t++){let t=[];for(let n of a){if(n.locations[0].scale===1&&n.locations[1].scale===1)continue;let r=v[n.locations[0].scale][n.locations[1].scale][e],i=[n.locations[r[0]]];t.push(...x(i,r[1],.7*u))}t.forEach(e=>e.locations=e.stage)}w()}},E=60,D=o(3)*E,O=[.85,1,1.15],k=[{cx:E*a(g(0)),cy:E*n(g(0))},{cx:E*a(g(120)),cy:E*n(g(120))},{cx:E*a(g(240)),cy:E*n(g(240))}];function A(e,t){return{...k[e],center:e,scale:t,radius:D*t}}function j(e,n,r){return{...e,angle:(t(n-e.cx,r-e.cy)*180/s+360)%360}}for(let{cx:e,cy:t}of k)for(let n of O)h(`circle`,{cx:e,cy:t,r:D*n,class:`orbit`});{let e=0;for(let[t,n,r]of[[0,1,`orange`],[0,2,`blue`],[1,0,`red`],[1,2,`yellow`],[2,0,`green`],[2,1,`white`]])for(let i of O)for(let a of O)new T(A(t,i),A(n,a),f[e]||r),e++}for(let e=0;e<k.length;e++)for(let t of O)b[e][t].sort((e,t)=>e.angle-t.angle),b[e][t].forEach((e,t)=>e.order=t);setInterval(()=>{y.forEach(e=>e.render())},25);</script>
  <style rel="stylesheet" crossorigin>svg{background-color:#faebd7;width:100vw;height:100vh;position:fixed;top:0;left:0}.orbit,.node{stroke:#000;stroke-width:1px}.orbit{fill:none}
/*$vite$:1*/</style>
</head>

<body>
  <svg>
    <g />
  </svg>
</body>

</html>